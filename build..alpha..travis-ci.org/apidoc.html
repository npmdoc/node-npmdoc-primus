<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="http://primus.io"

    >primus (v7.0.0)</a>
</h1>
<h4>Primus is a simple abstraction around real-time frameworks. It allows you to easily switch between different frameworks without any code changes.</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus">module primus</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.primus">
            function <span class="apidocSignatureSpan"></span>primus
            <span class="apidocSignatureSpan">(server, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark">
            function <span class="apidocSignatureSpan">primus.</span>Spark
            <span class="apidocSignatureSpan">(primus, headers, address, query, id, request)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer">
            function <span class="apidocSignatureSpan">primus.</span>Transformer
            <span class="apidocSignatureSpan">(primus)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.createServer">
            function <span class="apidocSignatureSpan">primus.</span>createServer
            <span class="apidocSignatureSpan">(fn, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.createSocket">
            function <span class="apidocSignatureSpan">primus.</span>createSocket
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.extend">
            function <span class="apidocSignatureSpan">primus.</span>extend
            <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.get">
            function <span class="apidocSignatureSpan">primus.</span>get
            <span class="apidocSignatureSpan">(method, getter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine">
            function <span class="apidocSignatureSpan">primus.</span>predefine
            <span class="apidocSignatureSpan">(obj, pattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.readable">
            function <span class="apidocSignatureSpan">primus.</span>readable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.set">
            function <span class="apidocSignatureSpan">primus.</span>set
            <span class="apidocSignatureSpan">(method, getter, setter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.writable">
            function <span class="apidocSignatureSpan">primus.</span>writable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.</span>errors</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.</span>json</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.</span>parsers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.</span>transformers</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus.Spark">module primus.Spark</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.Spark">
            function <span class="apidocSignatureSpan">primus.</span>Spark
            <span class="apidocSignatureSpan">(primus, headers, address, query, id, request)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.extend">
            function <span class="apidocSignatureSpan">primus.Spark.</span>extend
            <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.get">
            function <span class="apidocSignatureSpan">primus.Spark.</span>get
            <span class="apidocSignatureSpan">(method, getter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.predefine">
            function <span class="apidocSignatureSpan">primus.Spark.</span>predefine
            <span class="apidocSignatureSpan">(obj, pattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.readable">
            function <span class="apidocSignatureSpan">primus.Spark.</span>readable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.set">
            function <span class="apidocSignatureSpan">primus.Spark.</span>set
            <span class="apidocSignatureSpan">(method, getter, setter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Spark.writable">
            function <span class="apidocSignatureSpan">primus.Spark.</span>writable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">primus.Spark.</span>CLOSED</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">primus.Spark.</span>OPEN</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">primus.Spark.</span>OPENING</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus.Transformer">module primus.Transformer</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.Transformer">
            function <span class="apidocSignatureSpan">primus.</span>Transformer
            <span class="apidocSignatureSpan">(primus)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.extend">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>extend
            <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.get">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>get
            <span class="apidocSignatureSpan">(method, getter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.predefine">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>predefine
            <span class="apidocSignatureSpan">(obj, pattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.readable">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>readable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.set">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>set
            <span class="apidocSignatureSpan">(method, getter, setter)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.Transformer.writable">
            function <span class="apidocSignatureSpan">primus.Transformer.</span>writable
            <span class="apidocSignatureSpan">(method, description, clean)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus.errors">module primus.errors</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.errors.ParserError">
            function <span class="apidocSignatureSpan">primus.errors.</span>ParserError
            <span class="apidocSignatureSpan">(message, spark)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.errors.PrimusError">
            function <span class="apidocSignatureSpan">primus.errors.</span>PrimusError
            <span class="apidocSignatureSpan">(message, logger)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus.json">module primus.json</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.json.decoder">
            function <span class="apidocSignatureSpan">primus.json.</span>decoder
            <span class="apidocSignatureSpan">(data, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.json.encoder">
            function <span class="apidocSignatureSpan">primus.json.</span>encoder
            <span class="apidocSignatureSpan">(data, fn)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.primus.predefine">module primus.predefine</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.predefine">
            function <span class="apidocSignatureSpan">primus.</span>predefine
            <span class="apidocSignatureSpan">(obj, pattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.create">
            function <span class="apidocSignatureSpan">primus.predefine.</span>create
            <span class="apidocSignatureSpan">(property, description, pattern)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.descriptor">
            function <span class="apidocSignatureSpan">primus.predefine.</span>descriptor
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.each">
            function <span class="apidocSignatureSpan">primus.predefine.</span>each
            <span class="apidocSignatureSpan">(collection, iterator, context)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.extend">
            function <span class="apidocSignatureSpan">primus.predefine.</span>extend
            <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.lazy">
            function <span class="apidocSignatureSpan">primus.predefine.</span>lazy
            <span class="apidocSignatureSpan">(obj, prop, fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.merge">
            function <span class="apidocSignatureSpan">primus.predefine.</span>merge
            <span class="apidocSignatureSpan">(target, additional)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.mixin">
            function <span class="apidocSignatureSpan">primus.predefine.</span>mixin
            <span class="apidocSignatureSpan">(target)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.primus.predefine.remove">
            function <span class="apidocSignatureSpan">primus.predefine.</span>remove
            <span class="apidocSignatureSpan">(obj, keep)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.predefine.</span>READABLE</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">primus.predefine.</span>WRITABLE</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus" id="apidoc.module.primus">module primus</a></h1>


    <h2>
        <a href="#apidoc.element.primus.primus" id="apidoc.element.primus.primus">
        function <span class="apidocSignatureSpan"></span>primus
        <span class="apidocSignatureSpan">(server, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Primus(server, options) {
  if (!(this instanceof Primus)) return new Primus(server, options);

  this.fuse();

  if (&#x27;object&#x27; !== typeof server) {
    var message = &#x27;The first argument of the constructor must be &#x27; +
      &#x27;an HTTP or HTTPS server instance&#x27;;
    throw new PrimusError(message, this);
  }

  options = options || {};
  options.maxLength = options.maxLength || 10485760;  // Maximum allowed packet size.
  options.transport = options.transport || {};        // Transformer specific options.
  options.pingInterval = &#x27;pingInterval&#x27; in options    // Heartbeat interval.
    ? options.pingInterval
    : 30000;

  if (&#x27;timeout&#x27; in options) {
    throw new PrimusError(&#x27;The `timeout` option has been removed&#x27;, this);
  }

  var primus = this
    , key;

  this.auth = options.authorization || null;  // Do we have an authorization handler.
  this.connections = Object.create(null);     // Connection storage.
  this.ark = Object.create(null);             // Plugin storage.
  this.layers = [];                           // Middleware layers.
  this.heartbeatInterval = null;              // The heartbeat interval.
  this.transformer = null;                    // Reference to the real-time engine instance.
  this.encoder = null;                        // Shorthand to the parser&#x27;s encoder.
  this.decoder = null;                        // Shorthand to the parser&#x27;s decoder.
  this.connected = 0;                         // Connection counter.
  this.whitelist = [];                        // Forwarded-for white listing.
  this.options = options;                     // The configuration.
  this.transformers = {                       // Message transformers.
    outgoing: [],
    incoming: []
  };

  this.server = server;
  this.pathname = &#x27;string&#x27; === typeof options.pathname
    ? options.pathname.charAt(0) !== &#x27;/&#x27;
      ? &#x27;/&#x27;+ options.pathname
      : options.pathname
    : &#x27;/primus&#x27;;

  //
  // Create a specification file with the information that people might need to
  // connect to the server.
  //
  this.spec = {
    pingInterval: options.pingInterval,
    pathname: this.pathname,
    version: this.version
  };

  //
  // Create a pre-bound Spark constructor. Doing a Spark.bind(Spark, this) doesn&#x27;t
  // work as we cannot extend the constructor of it anymore. The added benefit of
  // approach listed below is that the prototype extensions are only applied to
  // the Spark of this Primus instance.
  //
  this.Spark = function Sparky(headers, address, query, id, request) {
    Spark.call(this, primus, headers, address, query, id, request);
  };

  this.Spark.prototype = Object.create(Spark.prototype, {
    constructor: {
      configurable: true,
      value: this.Spark,
      writable: true
    },
    __initialise: {
      value: Spark.prototype.__initialise.slice(),
      configurable: true,
      writable: true
    }
  });

  //
  // Copy over the original Spark static properties and methods so readable and
  // writable can also be used.
  //
  for (key in Spark) {
    this.Spark[key] = Spark[key];
  }

  this.parsers(options.parser);
  this.initialise(options.transformer, options);

  //
  // If the plugins are supplied through the options, also initialise them.
  // This also allows us to use plugins when creating a client constructor
  // with the `Primus.createSocket({})` method.
  //
  if (&#x27;string&#x27; === typeof options.plugin) {
    options.plugin.split(/[, ]+/).forEach(function register(name) {
      primus.plugin(name, name);
    });
  } else if (&#x27;object&#x27; === typeof options.plugin) {
    for (key in options.plugin) {
      this.plugin(key, options.plugin[key]);
    }
  }

  //
  // - Cluster node 0.10 lets the Operating System decide to which worker a request
  //   goes. This can result in a not even distribution where some workers are
  //   used at 10% while others at 90%. In addition to that the load balancing
  //   isn&#x27;t sticky.
  //
  // - Cluster node 0.12 implements a custom round robin algorithm. This solves the
  //   not even distribution of work but it does not address our sticky session
  //   requi ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark" id="apidoc.element.primus.Spark">
        function <span class="apidocSignatureSpan">primus.</span>Spark
        <span class="apidocSignatureSpan">(primus, headers, address, query, id, request)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Spark(primus, headers, address, query, id, request) {
  this.fuse();

  var writable = this.writable
    , spark = this;

  query = query || {};
  id = id || yeast();
  headers = headers || {};
  address = address || {};
  request = request || headers[&#x27;primus::req::backup&#x27;];

  writable(&#x27;id&#x27;, id);                   // Unique id for socket.
  writable(&#x27;primus&#x27;, primus);           // References to Primus.
  writable(&#x27;remote&#x27;, address);          // The remote address location.
  writable(&#x27;headers&#x27;, headers);         // The request headers.
  writable(&#x27;request&#x27;, request);         // Reference to an HTTP request.
  writable(&#x27;writable&#x27;, true);           // Silly stream compatibility.
  writable(&#x27;readable&#x27;, true);           // Silly stream compatibility.
  writable(&#x27;queue&#x27;, []);                // Data queue for data events.
  writable(&#x27;query&#x27;, query);             // The query string.
  writable(&#x27;ultron&#x27;, new Ultron(this)); // Our event listening cleanup.
  writable(&#x27;alive&#x27;, true);              // Flag used to detect zombie sparks.

  //
  // Parse our query string.
  //
  if (&#x27;string&#x27; === typeof this.query) {
    this.query = parse(this.query);
  }

  this.__initialise.forEach(function execute(initialise) {
    initialise.call(spark);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

//
// We&#x27;ve received a new connection, create a new Spark. The Spark will
// automatically announce it self as a new connection once it&#x27;s created (after
// the next tick).
//
this.service.on(&#x27;connection&#x27;, (socket) =&#x3e; {
  const spark = new this.<span class="apidocCodeKeywordSpan">Spark</span>(
      socket.request.headers  // HTTP request headers.
    , socket.request.primus   // IP Address location.
    , socket.request.query    // Optional query string.
    , socket.id               // Unique connection id.
    , socket.request          // Reference to the HTTP req.
  );
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer" id="apidoc.element.primus.Transformer">
        function <span class="apidocSignatureSpan">primus.</span>Transformer
        <span class="apidocSignatureSpan">(primus)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transformer(primus) {
  this.fuse();

  this.ultron = new Ultron(primus.server);  // Handles listeners with ease.
  this.Spark = primus.Spark;                // Reference to the Spark constructor.
  this.primus = primus;                     // Reference to the Primus instance.
  this.service = null;                      // Stores the real-time service.

  this.initialise();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.createServer" id="apidoc.element.primus.createServer">
        function <span class="apidocSignatureSpan">primus.</span>createServer
        <span class="apidocSignatureSpan">(fn, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createServer(fn, options) {
  if (&#x27;object&#x27; === typeof fn) {
    options = fn;
    fn = null;
  }

  options = options || {};

  var server = require(&#x27;create-server&#x27;)(Primus.prototype.merge.call(Primus, {
    http: function warn() {
      if (!options.iknowhttpsisbetter) [
        &#x27;&#x27;,
        &#x27;We\&#x27;ve detected that you\&#x27;re using a HTTP instead of a HTTPS server.&#x27;,
        &#x27;Please be aware that real-time connections have less chance of being blocked&#x27;,
        &#x27;by firewalls and anti-virus scanners if they are encrypted (using SSL). If&#x27;,
        &#x27;you run your server behind a reverse and HTTPS terminating proxy ignore&#x27;,
        &#x27;this message, if not, you\&#x27;ve been warned.&#x27;,
        &#x27;&#x27;
      ].forEach(function each(line) {
        console.log(&#x27;primus: &#x27;+ line);
      });
    }
  }, options));

  //
  // Now that we&#x27;ve got a server, we can setup the Primus and start listening.
  //
  var application = new Primus(server, options);

  if (fn) application.on(&#x27;connection&#x27;, fn);
  return application;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```js
&#x27;use strict&#x27;;

var Primus = require(&#x27;primus&#x27;)
  , http = require(&#x27;http&#x27;);

var server = http.<span class="apidocCodeKeywordSpan">createServer</span>(/* request handler */)
  , primus = new Primus(server, {/* options */});
```
The following options can be provided:

Name                | Description                               | Default
--------------------|-------------------------------------------|---------------
authorization       | Authorization handler                     | `null`
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.createSocket" id="apidoc.element.primus.createSocket">
        function <span class="apidocSignatureSpan">primus.</span>createSocket
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createSocket(options) {
  options = options || {};

  var primus = new Primus(new EventEmitter(), options);
  return primus.Socket;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

this.parsers(options.parser);
this.initialise(options.transformer, options);

//
// If the plugins are supplied through the options, also initialise them.
// This also allows us to use plugins when creating a client constructor
// with the `Primus.<span class="apidocCodeKeywordSpan">createSocket</span>({})` method.
//
if (&#x27;string&#x27; === typeof options.plugin) {
  options.plugin.split(/[, ]+/).forEach(function register(name) {
    primus.plugin(name, name);
  });
} else if (&#x27;object&#x27; === typeof options.plugin) {
  for (key in options.plugin) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.extend" id="apidoc.element.primus.extend">
        function <span class="apidocSignatureSpan">primus.</span>extend
        <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function extend(protoProps, staticProps) {
  var parent = this
    , child;

  //
  // The constructor function for the new subclass is either defined by you
  // (the &#x22;constructor&#x22; property in your `extend` definition), or defaulted
  // by us to simply call the parent&#x27;s constructor.
  //
  if (protoProps &#x26;&#x26; has.call(protoProps, &#x27;constructor&#x27;)) {
    child = protoProps.constructor;
  } else {
    child = mode(parent);
  }

  //
  // Set the prototype chain to inherit from `parent`, without calling
  // `parent`&#x27;s constructor function.
  //
  function Surrogate() {
    this.constructor = child;
  }

  Surrogate.prototype = parent.prototype;
  child.prototype = new Surrogate;

  //
  // Add prototype properties (instance properties) to the subclass,
  // if supplied.
  //
  if (protoProps) mixin(child.prototype, protoProps);

  //
  // Add static properties to the constructor function, if supplied.
  //
  copypaste(child, parent, staticProps);

  //
  // Set a convenience property in case the parent&#x27;s prototype is needed later.
  //
  child.__super__ = parent.prototype;

  return child;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var path = require(&#x27;path&#x27;)
, directory = require.resolve(&#x27;browserchannel&#x27;)
, library = path.join(path.dirname(directory), &#x27;dist/bcsocket-uncompressed.js&#x27;);

//
// Expose the module as new Transformer instance.
//
module.exports = require(&#x27;../../transformer&#x27;).<span class="apidocCodeKeywordSpan">extend</span>({
// Creating a new real-time server.
server: require(&#x27;./server&#x27;),

// The client-logic to connect with the a server.
client: require(&#x27;./client&#x27;),

// The client-side library of the browserchannel.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.get" id="apidoc.element.primus.get">
        function <span class="apidocSignatureSpan">primus.</span>get
        <span class="apidocSignatureSpan">(method, getter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function get(method, getter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter
  });

  return get;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Spark.writable(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.<span class="apidocCodeKeywordSpan">get</span>(&#x27;address&#x27;, function address() {
 return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
});

/**
* Checks if the given event is an emitted event by Primus.
*
* @param {String} evt The event name.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine" id="apidoc.element.primus.predefine">
        function <span class="apidocSignatureSpan">primus.</span>predefine
        <span class="apidocSignatureSpan">(obj, pattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefine(obj, pattern) {
  pattern = pattern || predefine.READABLE;

  return function predefined(method, description, clean) {
    //
    // If we are given a description compatible Object, use that instead of
    // setting it as value. This allows easy creation of getters and setters.
    //
    if (
         !predefine.descriptor(description)
      || is(description, &#x27;object&#x27;)
         &#x26;&#x26; !clean
         &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
    ) { description = {
        value: description
      };
    }

    //
    // Prevent thrown errors when we attempt to override a readonly
    // property
    //
    var described = Object.getOwnPropertyDescriptor(obj, method);
    if (described &#x26;&#x26; !described.configurable) {
      return predefined;
    }

    Object.defineProperty(obj, method, !clean
      ? predefine.mixin({}, pattern, description)
      : description
    );

    return predefined;
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.readable" id="apidoc.element.primus.readable">
        function <span class="apidocSignatureSpan">primus.</span>readable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Simple function to output common errors.
 *
 * @param {String} what What is missing.
 * @param {Object} where Either Primus.parsers or Primus.transformers.
 * @returns {Object}
 * @api private
 */
Primus.<span class="apidocCodeKeywordSpan">readable</span>(&#x27;is&#x27;, function is(what, where) {
var missing = Primus.parsers !== where
    ? &#x27;transformer&#x27;
    : &#x27;parser&#x27;
  , dependency = where[what];

return {
  missing: function write() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.set" id="apidoc.element.primus.set">
        function <span class="apidocSignatureSpan">primus.</span>set
        <span class="apidocSignatureSpan">(method, getter, setter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function set(method, getter, setter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter,
    set: setter
  });

  return set;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (chunk.buffer instanceof ArrayBuffer) {
      var buf = chunk.buffer;

      // if this is a subarray, make a copy so we only
      // include the subarray region from the underlying buffer
      if (chunk.byteLength !== buf.byteLength) {
        var copy = new Uint8Array(chunk.byteLength);
        copy.<span class="apidocCodeKeywordSpan">set</span>(new Uint8Array(buf, chunk.byteOffset, chunk.byteLength));
        buf = copy.buffer;
      }

      ary[i] = buf;
    }
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.writable" id="apidoc.element.primus.writable">
        function <span class="apidocSignatureSpan">primus.</span>writable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.__readyState = readyState;
  this.emit(&#x27;readyStateChange&#x27;);

  return readyState;
}
}, true);

Spark.<span class="apidocCodeKeywordSpan">writable</span>(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.get(&#x27;address&#x27;, function address() {
return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus.Spark" id="apidoc.module.primus.Spark">module primus.Spark</a></h1>


    <h2>
        <a href="#apidoc.element.primus.Spark.Spark" id="apidoc.element.primus.Spark.Spark">
        function <span class="apidocSignatureSpan">primus.</span>Spark
        <span class="apidocSignatureSpan">(primus, headers, address, query, id, request)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Spark(primus, headers, address, query, id, request) {
  this.fuse();

  var writable = this.writable
    , spark = this;

  query = query || {};
  id = id || yeast();
  headers = headers || {};
  address = address || {};
  request = request || headers[&#x27;primus::req::backup&#x27;];

  writable(&#x27;id&#x27;, id);                   // Unique id for socket.
  writable(&#x27;primus&#x27;, primus);           // References to Primus.
  writable(&#x27;remote&#x27;, address);          // The remote address location.
  writable(&#x27;headers&#x27;, headers);         // The request headers.
  writable(&#x27;request&#x27;, request);         // Reference to an HTTP request.
  writable(&#x27;writable&#x27;, true);           // Silly stream compatibility.
  writable(&#x27;readable&#x27;, true);           // Silly stream compatibility.
  writable(&#x27;queue&#x27;, []);                // Data queue for data events.
  writable(&#x27;query&#x27;, query);             // The query string.
  writable(&#x27;ultron&#x27;, new Ultron(this)); // Our event listening cleanup.
  writable(&#x27;alive&#x27;, true);              // Flag used to detect zombie sparks.

  //
  // Parse our query string.
  //
  if (&#x27;string&#x27; === typeof this.query) {
    this.query = parse(this.query);
  }

  this.__initialise.forEach(function execute(initialise) {
    initialise.call(spark);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

//
// We&#x27;ve received a new connection, create a new Spark. The Spark will
// automatically announce it self as a new connection once it&#x27;s created (after
// the next tick).
//
this.service.on(&#x27;connection&#x27;, (socket) =&#x3e; {
  const spark = new this.<span class="apidocCodeKeywordSpan">Spark</span>(
      socket.request.headers  // HTTP request headers.
    , socket.request.primus   // IP Address location.
    , socket.request.query    // Optional query string.
    , socket.id               // Unique connection id.
    , socket.request          // Reference to the HTTP req.
  );
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.extend" id="apidoc.element.primus.Spark.extend">
        function <span class="apidocSignatureSpan">primus.Spark.</span>extend
        <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function extend(protoProps, staticProps) {
  var parent = this
    , child;

  //
  // The constructor function for the new subclass is either defined by you
  // (the &#x22;constructor&#x22; property in your `extend` definition), or defaulted
  // by us to simply call the parent&#x27;s constructor.
  //
  if (protoProps &#x26;&#x26; has.call(protoProps, &#x27;constructor&#x27;)) {
    child = protoProps.constructor;
  } else {
    child = mode(parent);
  }

  //
  // Set the prototype chain to inherit from `parent`, without calling
  // `parent`&#x27;s constructor function.
  //
  function Surrogate() {
    this.constructor = child;
  }

  Surrogate.prototype = parent.prototype;
  child.prototype = new Surrogate;

  //
  // Add prototype properties (instance properties) to the subclass,
  // if supplied.
  //
  if (protoProps) mixin(child.prototype, protoProps);

  //
  // Add static properties to the constructor function, if supplied.
  //
  copypaste(child, parent, staticProps);

  //
  // Set a convenience property in case the parent&#x27;s prototype is needed later.
  //
  child.__super__ = parent.prototype;

  return child;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var path = require(&#x27;path&#x27;)
, directory = require.resolve(&#x27;browserchannel&#x27;)
, library = path.join(path.dirname(directory), &#x27;dist/bcsocket-uncompressed.js&#x27;);

//
// Expose the module as new Transformer instance.
//
module.exports = require(&#x27;../../transformer&#x27;).<span class="apidocCodeKeywordSpan">extend</span>({
// Creating a new real-time server.
server: require(&#x27;./server&#x27;),

// The client-logic to connect with the a server.
client: require(&#x27;./client&#x27;),

// The client-side library of the browserchannel.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.get" id="apidoc.element.primus.Spark.get">
        function <span class="apidocSignatureSpan">primus.Spark.</span>get
        <span class="apidocSignatureSpan">(method, getter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function get(method, getter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter
  });

  return get;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Spark.writable(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.<span class="apidocCodeKeywordSpan">get</span>(&#x27;address&#x27;, function address() {
 return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
});

/**
* Checks if the given event is an emitted event by Primus.
*
* @param {String} evt The event name.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.predefine" id="apidoc.element.primus.Spark.predefine">
        function <span class="apidocSignatureSpan">primus.Spark.</span>predefine
        <span class="apidocSignatureSpan">(obj, pattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefine(obj, pattern) {
  pattern = pattern || predefine.READABLE;

  return function predefined(method, description, clean) {
    //
    // If we are given a description compatible Object, use that instead of
    // setting it as value. This allows easy creation of getters and setters.
    //
    if (
         !predefine.descriptor(description)
      || is(description, &#x27;object&#x27;)
         &#x26;&#x26; !clean
         &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
    ) { description = {
        value: description
      };
    }

    //
    // Prevent thrown errors when we attempt to override a readonly
    // property
    //
    var described = Object.getOwnPropertyDescriptor(obj, method);
    if (described &#x26;&#x26; !described.configurable) {
      return predefined;
    }

    Object.defineProperty(obj, method, !clean
      ? predefine.mixin({}, pattern, description)
      : description
    );

    return predefined;
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.readable" id="apidoc.element.primus.Spark.readable">
        function <span class="apidocSignatureSpan">primus.Spark.</span>readable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Simple function to output common errors.
 *
 * @param {String} what What is missing.
 * @param {Object} where Either Primus.parsers or Primus.transformers.
 * @returns {Object}
 * @api private
 */
Primus.<span class="apidocCodeKeywordSpan">readable</span>(&#x27;is&#x27;, function is(what, where) {
var missing = Primus.parsers !== where
    ? &#x27;transformer&#x27;
    : &#x27;parser&#x27;
  , dependency = where[what];

return {
  missing: function write() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.set" id="apidoc.element.primus.Spark.set">
        function <span class="apidocSignatureSpan">primus.Spark.</span>set
        <span class="apidocSignatureSpan">(method, getter, setter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function set(method, getter, setter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter,
    set: setter
  });

  return set;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (chunk.buffer instanceof ArrayBuffer) {
      var buf = chunk.buffer;

      // if this is a subarray, make a copy so we only
      // include the subarray region from the underlying buffer
      if (chunk.byteLength !== buf.byteLength) {
        var copy = new Uint8Array(chunk.byteLength);
        copy.<span class="apidocCodeKeywordSpan">set</span>(new Uint8Array(buf, chunk.byteOffset, chunk.byteLength));
        buf = copy.buffer;
      }

      ary[i] = buf;
    }
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Spark.writable" id="apidoc.element.primus.Spark.writable">
        function <span class="apidocSignatureSpan">primus.Spark.</span>writable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.__readyState = readyState;
  this.emit(&#x27;readyStateChange&#x27;);

  return readyState;
}
}, true);

Spark.<span class="apidocCodeKeywordSpan">writable</span>(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.get(&#x27;address&#x27;, function address() {
return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus.Transformer" id="apidoc.module.primus.Transformer">module primus.Transformer</a></h1>


    <h2>
        <a href="#apidoc.element.primus.Transformer.Transformer" id="apidoc.element.primus.Transformer.Transformer">
        function <span class="apidocSignatureSpan">primus.</span>Transformer
        <span class="apidocSignatureSpan">(primus)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Transformer(primus) {
  this.fuse();

  this.ultron = new Ultron(primus.server);  // Handles listeners with ease.
  this.Spark = primus.Spark;                // Reference to the Spark constructor.
  this.primus = primus;                     // Reference to the Primus instance.
  this.service = null;                      // Stores the real-time service.

  this.initialise();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.extend" id="apidoc.element.primus.Transformer.extend">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>extend
        <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function extend(protoProps, staticProps) {
  var parent = this
    , child;

  //
  // The constructor function for the new subclass is either defined by you
  // (the &#x22;constructor&#x22; property in your `extend` definition), or defaulted
  // by us to simply call the parent&#x27;s constructor.
  //
  if (protoProps &#x26;&#x26; has.call(protoProps, &#x27;constructor&#x27;)) {
    child = protoProps.constructor;
  } else {
    child = mode(parent);
  }

  //
  // Set the prototype chain to inherit from `parent`, without calling
  // `parent`&#x27;s constructor function.
  //
  function Surrogate() {
    this.constructor = child;
  }

  Surrogate.prototype = parent.prototype;
  child.prototype = new Surrogate;

  //
  // Add prototype properties (instance properties) to the subclass,
  // if supplied.
  //
  if (protoProps) mixin(child.prototype, protoProps);

  //
  // Add static properties to the constructor function, if supplied.
  //
  copypaste(child, parent, staticProps);

  //
  // Set a convenience property in case the parent&#x27;s prototype is needed later.
  //
  child.__super__ = parent.prototype;

  return child;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var path = require(&#x27;path&#x27;)
, directory = require.resolve(&#x27;browserchannel&#x27;)
, library = path.join(path.dirname(directory), &#x27;dist/bcsocket-uncompressed.js&#x27;);

//
// Expose the module as new Transformer instance.
//
module.exports = require(&#x27;../../transformer&#x27;).<span class="apidocCodeKeywordSpan">extend</span>({
// Creating a new real-time server.
server: require(&#x27;./server&#x27;),

// The client-logic to connect with the a server.
client: require(&#x27;./client&#x27;),

// The client-side library of the browserchannel.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.get" id="apidoc.element.primus.Transformer.get">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>get
        <span class="apidocSignatureSpan">(method, getter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function get(method, getter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter
  });

  return get;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Spark.writable(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.<span class="apidocCodeKeywordSpan">get</span>(&#x27;address&#x27;, function address() {
 return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
});

/**
* Checks if the given event is an emitted event by Primus.
*
* @param {String} evt The event name.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.predefine" id="apidoc.element.primus.Transformer.predefine">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>predefine
        <span class="apidocSignatureSpan">(obj, pattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefine(obj, pattern) {
  pattern = pattern || predefine.READABLE;

  return function predefined(method, description, clean) {
    //
    // If we are given a description compatible Object, use that instead of
    // setting it as value. This allows easy creation of getters and setters.
    //
    if (
         !predefine.descriptor(description)
      || is(description, &#x27;object&#x27;)
         &#x26;&#x26; !clean
         &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
    ) { description = {
        value: description
      };
    }

    //
    // Prevent thrown errors when we attempt to override a readonly
    // property
    //
    var described = Object.getOwnPropertyDescriptor(obj, method);
    if (described &#x26;&#x26; !described.configurable) {
      return predefined;
    }

    Object.defineProperty(obj, method, !clean
      ? predefine.mixin({}, pattern, description)
      : description
    );

    return predefined;
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.readable" id="apidoc.element.primus.Transformer.readable">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>readable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Simple function to output common errors.
 *
 * @param {String} what What is missing.
 * @param {Object} where Either Primus.parsers or Primus.transformers.
 * @returns {Object}
 * @api private
 */
Primus.<span class="apidocCodeKeywordSpan">readable</span>(&#x27;is&#x27;, function is(what, where) {
var missing = Primus.parsers !== where
    ? &#x27;transformer&#x27;
    : &#x27;parser&#x27;
  , dependency = where[what];

return {
  missing: function write() {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.set" id="apidoc.element.primus.Transformer.set">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>set
        <span class="apidocSignatureSpan">(method, getter, setter)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function set(method, getter, setter) {
  Object.defineProperty(Base.prototype, method, {
    configurable: false,
    enumerable: false,
    get: getter,
    set: setter
  });

  return set;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    if (chunk.buffer instanceof ArrayBuffer) {
      var buf = chunk.buffer;

      // if this is a subarray, make a copy so we only
      // include the subarray region from the underlying buffer
      if (chunk.byteLength !== buf.byteLength) {
        var copy = new Uint8Array(chunk.byteLength);
        copy.<span class="apidocCodeKeywordSpan">set</span>(new Uint8Array(buf, chunk.byteOffset, chunk.byteLength));
        buf = copy.buffer;
      }

      ary[i] = buf;
    }
  }
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.Transformer.writable" id="apidoc.element.primus.Transformer.writable">
        function <span class="apidocSignatureSpan">primus.Transformer.</span>writable
        <span class="apidocSignatureSpan">(method, description, clean)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefined(method, description, clean) {
  //
  // If we are given a description compatible Object, use that instead of
  // setting it as value. This allows easy creation of getters and setters.
  //
  if (
       !predefine.descriptor(description)
    || is(description, &#x27;object&#x27;)
       &#x26;&#x26; !clean
       &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
  ) { description = {
      value: description
    };
  }

  //
  // Prevent thrown errors when we attempt to override a readonly
  // property
  //
  var described = Object.getOwnPropertyDescriptor(obj, method);
  if (described &#x26;&#x26; !described.configurable) {
    return predefined;
  }

  Object.defineProperty(obj, method, !clean
    ? predefine.mixin({}, pattern, description)
    : description
  );

  return predefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.__readyState = readyState;
  this.emit(&#x27;readyStateChange&#x27;);

  return readyState;
}
}, true);

Spark.<span class="apidocCodeKeywordSpan">writable</span>(&#x27;__readyState&#x27;, Spark.OPEN);

//
// Lazy parse interface for IP address information. As nobody is always
// interested in this, we&#x27;re going to defer parsing until it&#x27;s actually needed.
//
Spark.get(&#x27;address&#x27;, function address() {
return this.request.forwarded || forwarded(this.remote, this.headers, this.primus.whitelist);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus.errors" id="apidoc.module.primus.errors">module primus.errors</a></h1>


    <h2>
        <a href="#apidoc.element.primus.errors.ParserError" id="apidoc.element.primus.errors.ParserError">
        function <span class="apidocSignatureSpan">primus.errors.</span>ParserError
        <span class="apidocSignatureSpan">(message, spark)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ParserError(message, spark) {
  Error.captureStackTrace(this, this.constructor);

  this.message = message;
  this.name = this.constructor.name;

  if (spark) {
    if (spark.listeners(&#x27;error&#x27;).length) spark.emit(&#x27;error&#x27;, this);
    spark.primus.emit(&#x27;log&#x27;, &#x27;error&#x27;, this);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.errors.PrimusError" id="apidoc.element.primus.errors.PrimusError">
        function <span class="apidocSignatureSpan">primus.errors.</span>PrimusError
        <span class="apidocSignatureSpan">(message, logger)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrimusError(message, logger) {
  Error.captureStackTrace(this, this.constructor);

  this.message = message;
  this.name = this.constructor.name;

  if (logger) {
    logger.emit(&#x27;log&#x27;, &#x27;error&#x27;, this);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus.json" id="apidoc.module.primus.json">module primus.json</a></h1>


    <h2>
        <a href="#apidoc.element.primus.json.decoder" id="apidoc.element.primus.json.decoder">
        function <span class="apidocSignatureSpan">primus.json.</span>decoder
        <span class="apidocSignatureSpan">(data, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function decoder(data, fn) {
  var err;

  if (&#x27;string&#x27; !== typeof data) return fn(err, data);

  try { data = JSON.parse(data); }
  catch (e) { err = e; }

  fn(err, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
} else {
  primus.end();
}
    }
  });

  primus.on(&#x27;incoming::data&#x27;, function message(raw) {
    primus.<span class="apidocCodeKeywordSpan">decoder</span>(raw, function decoding(err, data) {
//
// Do a &#x22;safe&#x22; emit(&#x27;error&#x27;) when we fail to parse a message. We don&#x27;t
// want to throw here as listening to errors should be optional.
//
if (err) return primus.listeners(&#x27;error&#x27;).length &#x26;&#x26; primus.emit(&#x27;error&#x27;, err);

//
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.json.encoder" id="apidoc.element.primus.json.encoder">
        function <span class="apidocSignatureSpan">primus.json.</span>encoder
        <span class="apidocSignatureSpan">(data, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function encoder(data, fn) {
  var err;

  try { data = JSON.stringify(data); }
  catch (e) { err = e; }

  fn(err, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.buffer.splice(0, 1);
}

this.buffer.push(data);
return false;
  }

  primus.<span class="apidocCodeKeywordSpan">encoder</span>(data, function encoded(err, packet) {
//
// Do a &#x22;safe&#x22; emit(&#x27;error&#x27;) when we fail to parse a message. We don&#x27;t
// want to throw here as listening to errors should be optional.
//
if (err) return primus.listeners(&#x27;error&#x27;).length &#x26;&#x26; primus.emit(&#x27;error&#x27;, err);

//
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.primus.predefine" id="apidoc.module.primus.predefine">module primus.predefine</a></h1>


    <h2>
        <a href="#apidoc.element.primus.predefine.predefine" id="apidoc.element.primus.predefine.predefine">
        function <span class="apidocSignatureSpan">primus.</span>predefine
        <span class="apidocSignatureSpan">(obj, pattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function predefine(obj, pattern) {
  pattern = pattern || predefine.READABLE;

  return function predefined(method, description, clean) {
    //
    // If we are given a description compatible Object, use that instead of
    // setting it as value. This allows easy creation of getters and setters.
    //
    if (
         !predefine.descriptor(description)
      || is(description, &#x27;object&#x27;)
         &#x26;&#x26; !clean
         &#x26;&#x26; !predefine.descriptor(predefine.mixin({}, pattern, description))
    ) { description = {
        value: description
      };
    }

    //
    // Prevent thrown errors when we attempt to override a readonly
    // property
    //
    var described = Object.getOwnPropertyDescriptor(obj, method);
    if (described &#x26;&#x26; !described.configurable) {
      return predefined;
    }

    Object.defineProperty(obj, method, !clean
      ? predefine.mixin({}, pattern, description)
      : description
    );

    return predefined;
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.create" id="apidoc.element.primus.predefine.create">
        function <span class="apidocSignatureSpan">primus.predefine.</span>create
        <span class="apidocSignatureSpan">(property, description, pattern)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function create(property, description, pattern) {
  pattern = pattern || {};

  if (!predefine.descriptor(description)) description = {
    enumberable: false,
    value: description
  };

  var definition = {};
  definition[property] = predefine.mixin(pattern, description);

  return definition;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  throw new PrimusError(&#x27;The `timeout` option has been removed&#x27;, this);
}

var primus = this
  , key;

this.auth = options.authorization || null;  // Do we have an authorization handler.
this.connections = Object.<span class="apidocCodeKeywordSpan">create</span>(null);     // Connection storage.
this.ark = Object.create(null);             // Plugin storage.
this.layers = [];                           // Middleware layers.
this.heartbeatInterval = null;              // The heartbeat interval.
this.transformer = null;                    // Reference to the real-time engine instance.
this.encoder = null;                        // Shorthand to the parser&#x27;s encoder.
this.decoder = null;                        // Shorthand to the parser&#x27;s decoder.
this.connected = 0;                         // Connection counter.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.descriptor" id="apidoc.element.primus.predefine.descriptor">
        function <span class="apidocSignatureSpan">primus.predefine.</span>descriptor
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function descriptor(obj) {
  if (!obj || &#x27;object&#x27; !== typeof obj || Array.isArray(obj)) return false;

  var keys = Object.keys(obj);

  //
  // A descriptor can only be a data or accessor descriptor, never both.
  // An data descriptor can only specify:
  //
  // - configurable
  // - enumerable
  // - (optional) value
  // - (optional) writable
  //
  // And an accessor descriptor can only specify;
  //
  // - configurable
  // - enumerable
  // - (optional) get
  // - (optional) set
  //
  if (
       (&#x27;value&#x27; in obj || &#x27;writable&#x27; in obj)
    &#x26;&#x26; (&#x27;function&#x27; === typeof obj.set || &#x27;function&#x27; === typeof obj.get)
  ) return false;

  return !!keys.length &#x26;&#x26; keys.every(function allowed(key) {
    var type = description[key]
      , valid = type === undefined || is(obj[key], type);

    return key in description &#x26;&#x26; valid;
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.each" id="apidoc.element.primus.predefine.each">
        function <span class="apidocSignatureSpan">primus.predefine.</span>each
        <span class="apidocSignatureSpan">(collection, iterator, context)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function each(collection, iterator, context) {
  if (arguments.length === 1) {
    iterator = collection;
    collection = this;
  }

  var isArray = Array.isArray(collection || this)
    , length = collection.length
    , i = 0
    , value;

  if (context) {
    if (isArray) {
      for (; i &#x3c; length; i++) {
        value = iterator.apply(collection[ i ], context);
        if (value === false) break;
      }
    } else {
      for (i in collection) {
        value = iterator.apply(collection[ i ], context);
        if (value === false) break;
      }
    }
  } else {
    if (isArray) {
      for (; i &#x3c; length; i++) {
        value = iterator.call(collection[i], i, collection[i]);
        if (value === false) break;
      }
    } else {
      for (i in collection) {
        value = iterator.call(collection[i], i, collection[i]);
        if (value === false) break;
      }
    }
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.extend" id="apidoc.element.primus.predefine.extend">
        function <span class="apidocSignatureSpan">primus.predefine.</span>extend
        <span class="apidocSignatureSpan">(protoProps, staticProps)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function extend(protoProps, staticProps) {
  var parent = this
    , child;

  //
  // The constructor function for the new subclass is either defined by you
  // (the &#x22;constructor&#x22; property in your `extend` definition), or defaulted
  // by us to simply call the parent&#x27;s constructor.
  //
  if (protoProps &#x26;&#x26; has.call(protoProps, &#x27;constructor&#x27;)) {
    child = protoProps.constructor;
  } else {
    child = mode(parent);
  }

  //
  // Set the prototype chain to inherit from `parent`, without calling
  // `parent`&#x27;s constructor function.
  //
  function Surrogate() {
    this.constructor = child;
  }

  Surrogate.prototype = parent.prototype;
  child.prototype = new Surrogate;

  //
  // Add prototype properties (instance properties) to the subclass,
  // if supplied.
  //
  if (protoProps) mixin(child.prototype, protoProps);

  //
  // Add static properties to the constructor function, if supplied.
  //
  copypaste(child, parent, staticProps);

  //
  // Set a convenience property in case the parent&#x27;s prototype is needed later.
  //
  child.__super__ = parent.prototype;

  return child;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var path = require(&#x27;path&#x27;)
, directory = require.resolve(&#x27;browserchannel&#x27;)
, library = path.join(path.dirname(directory), &#x27;dist/bcsocket-uncompressed.js&#x27;);

//
// Expose the module as new Transformer instance.
//
module.exports = require(&#x27;../../transformer&#x27;).<span class="apidocCodeKeywordSpan">extend</span>({
// Creating a new real-time server.
server: require(&#x27;./server&#x27;),

// The client-logic to connect with the a server.
client: require(&#x27;./client&#x27;),

// The client-side library of the browserchannel.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.lazy" id="apidoc.element.primus.predefine.lazy">
        function <span class="apidocSignatureSpan">primus.predefine.</span>lazy
        <span class="apidocSignatureSpan">(obj, prop, fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function lazy(obj, prop, fn) {
  Object.defineProperty(obj, prop, {
    configurable: true,

    get: function get() {
      return Object.defineProperty(this, prop, {
        value: fn.call(this)
      })[prop];
    },

    set: function set(value) {
      return Object.defineProperty(this, prop, {
        value: value
      })[prop];
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.merge" id="apidoc.element.primus.predefine.merge">
        function <span class="apidocSignatureSpan">primus.predefine.</span>merge
        <span class="apidocSignatureSpan">(target, additional)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function merge(target, additional) {
  var result = target
    , undefined;

  if (Array.isArray(target)) {
    each(additional, function arrayForEach(index) {
      if (JSON.stringify(target).indexOf(JSON.stringify(additional[index])) === -1) {
        result.push(additional[index]);
      }
    });
  } else if (&#x27;object&#x27; === typeof target) {
    each(additional, function objectForEach(key, value) {
      if (target[key] === undefined) {
        result[key] = value;
      } else {
        result[key] = merge(target[key], additional[key]);
      }
    });
  } else {
    result = additional;
  }

  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* Create a shallow clone of a given object.
*
* @param {Object} obj The object that needs to be cloned.
* @returns {Object} Copy.
* @api private
*/
Primus.prototype.clone = function clone(obj) {
 return this.<span class="apidocCodeKeywordSpan">merge</span>({}, obj);
};

/**
* Merge different objects in to one target object.
*
* @param {Object} target The object where everything should be merged in.
* @returns {Object} Original target with all merged objects.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.mixin" id="apidoc.element.primus.predefine.mixin">
        function <span class="apidocSignatureSpan">primus.predefine.</span>mixin
        <span class="apidocSignatureSpan">(target)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function mixin(target) {
  Array.prototype.slice.call(arguments, 1).forEach(function forEach(o) {
    Object.getOwnPropertyNames(o).forEach(function eachAttr(attr) {
      Object.defineProperty(target, attr, Object.getOwnPropertyDescriptor(o, attr));
    });
  });

  return target;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.primus.predefine.remove" id="apidoc.element.primus.predefine.remove">
        function <span class="apidocSignatureSpan">primus.predefine.</span>remove
        <span class="apidocSignatureSpan">(obj, keep)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function remove(obj, keep) {
  if (!obj) return false;
  keep = keep || [];

  for (var prop in obj) {
    if (has.call(obj, prop) &#x26;&#x26; !~keep.indexOf(prop)) {
      delete obj[prop];
    }
  }

  return true;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```js
// add a middleware after the first two in the stack
primus.use(&#x27;name&#x27;, function (req, res) {

}, 2);
```

#### Primus.<span class="apidocCodeKeywordSpan">remove</span>(name)

This method allows you to remove configured middleware. This works
for the middleware layers that you added but also the middleware layers that we
add by default. If you want to use a different way to serve the `primus.js`
file you can simply:

```js
...</pre></li>
    </ul>






</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
